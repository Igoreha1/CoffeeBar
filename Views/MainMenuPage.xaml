<Page x:Class="CoffeeBar.Views.MainMenuPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      mc:Ignorable="d"
      d:DesignHeight="800" d:DesignWidth="1200"
      Title="Главное меню CoffeeBar"
      Background="#FFF9F5F0">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Шапка с пользователем и кнопками -->
        <Border Grid.Row="0" Background="#FF6D4C41" Padding="15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Логотип -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                    <TextBlock Text="☕" FontSize="28" Foreground="White" Margin="0,0,10,0"/>
                    <TextBlock Text="CoffeeBar" 
                             Foreground="White" 
                             FontSize="22" 
                             FontWeight="Bold"
                             FontFamily="Segoe UI"
                             VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Имя пользователя -->
                <TextBlock x:Name="UsernameTextBlock"
                         Grid.Column="1"
                         Text="Пользователь"
                         Foreground="White"
                         FontSize="16"
                         HorizontalAlignment="Center"
                         VerticalAlignment="Center"/>

                <!-- Кнопки управления -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button x:Name="CartButton"
                          Content="🛒 Корзина"
                          Background="Transparent"
                          Foreground="White"
                          BorderThickness="0"
                          FontWeight="Bold"
                          Margin="5,0"
                          Padding="10,5"
                          Click="CartButton_Click"
                          Cursor="Hand"/>

                    <Button x:Name="AdminPanelButton"
                          Content="⚙️ Админ"
                          Background="Transparent"
                          Foreground="White"
                          BorderThickness="0"
                          FontWeight="Bold"
                          Margin="5,0"
                          Padding="10,5"
                          Click="AdminPanelButton_Click"
                          Cursor="Hand"
                          Visibility="Collapsed"/>

                    <Button x:Name="LogoutButton"
                          Content="🚪 Выход"
                          Background="Transparent"
                          Foreground="White"
                          BorderThickness="0"
                          FontWeight="Bold"
                          Margin="5,0"
                          Padding="10,5"
                          Click="LogoutButton_Click"
                          Cursor="Hand"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Панель поиска и фильтров -->
        <Border Grid.Row="1" Background="#FFF5E9E0" Padding="15">
            <StackPanel>
                <!-- Поиск -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,15">
                    <TextBox x:Name="SearchTextBox" 
                           Width="300" 
                           Height="40" 
                           FontSize="16"
                           Padding="10"
                           BorderBrush="#FFA1887F"
                           BorderThickness="2"
                           TextChanged="SearchTextBox_TextChanged"/>
                </StackPanel>

                <!-- Фильтры и сортировка -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,10">
                    <!-- Категории -->
                    <TextBlock Text="Категория:" 
                             Foreground="#FF5D4037"
                             FontWeight="Bold"
                             VerticalAlignment="Center"
                             Margin="0,0,10,0"/>

                    <ComboBox x:Name="CategoryComboBox"
                            Width="200"
                            Height="35"
                            FontSize="14"
                            SelectionChanged="CategoryComboBox_SelectionChanged"
                            Margin="0,0,20,0">
                        <ComboBoxItem Content="Все категории" Tag="0" IsSelected="True"/>
                    </ComboBox>

                    <!-- Сортировка -->
                    <TextBlock Text="Сортировка:" 
                             Foreground="#FF5D4037"
                             FontWeight="Bold"
                             VerticalAlignment="Center"
                             Margin="0,0,10,0"/>

                    <ComboBox x:Name="SortComboBox"
                            Width="200"
                            Height="35"
                            FontSize="14"
                            SelectionChanged="SortComboBox_SelectionChanged">
                        <ComboBoxItem Content="По умолчанию" Tag="default"/>
                        <ComboBoxItem Content="По цене (возр.)" Tag="price_asc"/>
                        <ComboBoxItem Content="По цене (убыв.)" Tag="price_desc"/>
                        <ComboBoxItem Content="По названию (А-Я)" Tag="name_asc"/>
                        <ComboBoxItem Content="По названию (Я-А)" Tag="name_desc"/>
                    </ComboBox>
                </StackPanel>

                <!-- Итоговая цена -->
                <TextBlock x:Name="TotalPriceTextBlock"
                         Text="Итого: 0 руб"
                         Foreground="#FF6D4C41"
                         FontWeight="Bold"
                         FontSize="16"
                         HorizontalAlignment="Center"
                         Margin="0,10,0,0"/>
            </StackPanel>
        </Border>

        <!-- Сетка товаров -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" Padding="20">
            <ItemsControl x:Name="ProductsItemsControl">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Orientation="Horizontal" HorizontalAlignment="Center"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Width="250" 
                              Height="320" 
                              Margin="15" 
                              Background="White"
                              BorderBrush="#FFD7CCC8"
                              BorderThickness="1"
                              CornerRadius="10">
                            <StackPanel>
                                <!-- Изображение товара -->
                                <TextBlock Text="☕" 
                                         FontSize="64" 
                                         HorizontalAlignment="Center" 
                                         Margin="0,20,0,10"/>

                                <!-- Название и описание -->
                                <TextBlock Text="{Binding ProductName}" 
                                         FontSize="18" 
                                         FontWeight="Bold"
                                         Foreground="#FF4E2E25"
                                         HorizontalAlignment="Center"
                                         TextAlignment="Center"
                                         Margin="10,0,10,5"
                                         TextWrapping="Wrap"/>

                                <TextBlock Text="{Binding Description}" 
                                         FontSize="14" 
                                         Foreground="#FF795548"
                                         HorizontalAlignment="Center"
                                         TextAlignment="Center"
                                         Margin="10,0,10,10"
                                         TextWrapping="Wrap"
                                         Height="40"/>

                                <!-- Цена -->
                                <TextBlock Text="{Binding Price, StringFormat='{}₽ {0}'}" 
                                         FontSize="20" 
                                         FontWeight="Bold"
                                         Foreground="#FF6D4C41"
                                         HorizontalAlignment="Center"
                                         Margin="0,0,0,10"/>

                                <!-- Категория -->
                                <TextBlock Text="{Binding CategoryName}" 
                                         FontSize="12" 
                                         Foreground="#FF9E9E9E"
                                         HorizontalAlignment="Center"
                                         Margin="0,0,0,10"
                                         FontStyle="Italic"/>

                                <!-- Кнопка добавления -->
                                <Button Content="В корзину" 
                                      Background="#FF6D4C41"
                                      Foreground="White"
                                      FontWeight="Bold"
                                      Height="35"
                                      Margin="20,0,20,20"
                                      Click="AddToCartButton_Click"
                                      Tag="{Binding ProductID}"
                                      Cursor="Hand">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="BorderThickness" Value="0"/>
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#FF4E2E25"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</Page>